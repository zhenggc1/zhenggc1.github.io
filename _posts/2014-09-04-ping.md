---
layout: post
title: "从ping开始"
description: ""
category: 
tags: [ping,tcp/ip]
---
{% include JB/setup %}

网络性能问题的讨论，就涉及到tcp/ip协族议，tcp/ip协议族里最简单的协议应该是ping所用的icmp了。
简单的描述ping的工作如下

> +----+    req       +----+ 
> |    +------------> |    | 
> |c   |              | s  | 
> |    | <------------|    | 
> +----+      resp    +----+

客户端发起一个请求，服务端接收到了之后，就返回一个结果给客户端。
那问题来了，假设服务端处理的消耗时间是一样长的，为什么ping不同的机器返回的时间是不一样的。

在win下或者*nix下都有命令知道icmp包走过了哪些地方。这就是tracert或者traceroute。
用法都很简单，直接返回经过的一些地址。

比如我在tracert google的public dns地址8.8.8.8，返回如下结果

> tracert 8.8.8.8
> 
> 通过最多 30 个跃点跟踪
> 到 google-public-dns-a.google.com [8.8.8.8] 的路由:
>
>  1    13 ms     1 ms     1 ms  内部网络，暂不暴露
>  2     2 ms     2 ms     3 ms  内部网络，暂不暴露
>  3     8 ms     2 ms     2 ms  内部网络，暂不暴露
>  4    45 ms    43 ms    34 ms  202.55.20.9    #香港
>  5    64 ms    52 ms    55 ms  202.55.1.109   #香港
>  6    77 ms   128 ms    64 ms  59.43.249.6    #广东
>  7   102 ms    94 ms   148 ms  59.43.249.241  #广东
>  8   148 ms   127 ms   108 ms  google.sgix.sg [103.16.102.64] #新加坡
>  9   103 ms   107 ms   115 ms  66.249.95.124    #美国
> 10   113 ms   180 ms   133 ms  72.14.239.61     #美国
> 11     *        *        *     请求超时。       #可能屏蔽了icmp包，或者真的超时了
> 12   368 ms   415 ms   429 ms  google-public-dns-a.google.com [8.8.8.8]  #美国 目的地址
>
>跟踪完成。
>

看来上术的结果，除了我隐藏的内部地址，这个包依次要经过香港，广东，新加坡，美国，美国还有好几跳，才到目的地址，最后回到我的机器
花费了400多ms，绕了大半个地球，还是蛮快的吧。

如果根据tracert出来的ip，逐个ping下，会发现ping的结果，和上面tracert出来的结果差不多，其实tracert也是使用了icmp包来做侦测。
并且上属的时间总体处于上升的趋势，我们发现距离越远，ping的值就越大。

那我们可以暂且简单的认为，网络的rt消耗，就和两端的距离有关系。至于是什么关系，需要细致的了解传输介质的一些物理特性了。

